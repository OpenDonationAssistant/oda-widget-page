!function(){if(window.VK||(window.VK={}),VK.VideoPlayer)return;var e={INITED:"inited",TIMEUPDATE:"timeupdate",VOLUMECHANGE:"volumechange",QUALITYCHANGE:"qualitychange",STARTED:"started",RESUMED:"resumed",PAUSED:"paused",ENDED:"ended",ERROR:"error"},t={UNINITED:"uninited",UNSTARTED:"unstarted",PLAYING:"playing",PAUSED:"paused",ENDED:"ended",ERROR:"error"};function n(e){return/^(https?:)?\/\/([a-zA-Z0-9\-_.]+\.)?vk\.com\/video_e(xt|mbed)\.php\?/.test(e)}VK.VideoPlayer=function(a){if(!n(a.src))throw Error("iframe src is not a VK embed");if(!/[?&]js_api=/.test(a.src))throw Error("iframe src js_api param is missing");var i={state:t.UNINITED,volume:1,muted:!1,time:0,duration:0,quality:0},o={},u=[],r="*";return window.addEventListener("message",d),s({method:"init"}),{play:function(){s({method:"play"})},pause:function(){s({method:"pause"})},seek:function(e){s({method:"seek",time:e})},seekLive:function(){s({method:"seekLive"})},setVolume:function(e){s({method:"set_volume",volume:e}),i.volume=e,i.muted=!1},getVolume:function(){return i.volume},getCurrentTime:function(){return i.time},getDuration:function(){return i.duration},mute:function(){s({method:"mute"}),i.muted=!0},unmute:function(){s({method:"unmute"}),i.muted=!1},isMuted:function(){return i.muted},getState:function(){return i.state},on:function(e,t){o[e]=o[e]||[],o[e].push(t)},off:function(e,t){const n=o[e]?o[e].indexOf(t):-1;n>-1&&o[e].splice(n,1)},destroy:function(){window.removeEventListener("message",d),o={}}};function d(o){if(o.source===a.contentWindow){"*"===r&&n(a.src)&&(r=o.origin);var d=o.data.event;switch(d){case e.INITED:i.state=o.data.state,i.time=o.data.time,i.duration=o.data.duration,i.volume=o.data.volume,i.muted=o.data.muted,m(d),function(){for(;u.length;){s(u.shift())}}();break;case e.TIMEUPDATE:i.time=o.data.time,m(d);break;case e.VOLUMECHANGE:i.volume=o.data.volume,i.muted=o.data.muted,m(d);break;case e.QUALITYCHANGE:i.quality=o.data.quality,m(d);break;case e.STARTED:i.state=t.PLAYING,i.time=o.data.time,window.setTimeout((()=>{m(d)}),500);break;case e.RESUMED:i.state=t.PLAYING,i.time=o.data.time,m(d);break;case e.PAUSED:case e.ENDED:case e.ERROR:i.state=d,i.time=o.data.time,m(d)}}}function s(e){i.state!==t.UNINITED||"init"===e.method?a.contentWindow.postMessage(e,r):u.push(e)}function m(e){var t=function(){var e={};for(var t in i)e[t]=i[t];return e}();(o[e]||[]).forEach((function(e){if("function"==typeof e)try{e(t)}catch(e){console.error(e)}}))}},VK.VideoPlayer.Events=e,VK.VideoPlayer.States=t}();
